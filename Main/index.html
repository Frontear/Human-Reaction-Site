<!DOCTYPE html>
<html>
<head>
	<!-- Import StyleSheet, Icon, and FontAwesome -->
	<link rel="icon" href="https://puu.sh/yF7r5/6b4c2965e9.png">
	<link href="style.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- Import CodeHS dependancies-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="https://static.codehs.com/gulp/e26ebba34dbd5a61508528cd3ed00b5c328f4c09/chs-js-lib/chs.js"></script>

	<!-- Import my custom time script -->
	<script type="text/javascript" src="https://puu.sh/yF8jv/897fde5cdc.js"></script>
	<title>Human Reaction Test</title>
</head>
<body class="bg-gradient fg-white center-text">
	<div class="fade-in">
		<table class="tables">
			<tr>
				<td><a style="float: left; margin-left: 5px;" class="table-a">Human Reaction</a></td>
				<td><a style="float: right; margin-right: 5px;" class="table-a" id="time"></a></td>
			</tr>
		</table>
		<h1>Human Reaction Test</h1>
		<canvas class="codehs-editor-canvas"></canvas>
		<p>Welcome to the Human Reaction Test. You will attempt to press a green circle as fast as you can when it appears. You will get five tries, and the site will average all scores into your reaction time. Try to beat the world average of 250ms!</p>
		<button id="button" class="button button-shadow"><i id="icon" class="fa fa-github" aria-hidden="true"></i><a id="text" href="https://github.com/Frontear/Human-Reaction-Site" style="color: black;" target="_blank">&nbsp;GitHub</a></button>
	</div>
	<script>
		/* Imported from CodeHS */
		window.onload = function () {

			// Global Variables
			var loops;
			var playedBefore;
			var beginPlaying;
			var doesCircleExist;
			var playerLost;
			var secondsBeforeClicked;
			var reactionAverage;

			// Gets the width and height of canvas, then find the center.
			var screen = [getWidth(), getHeight(), getWidth() / 2, getHeight() / 2];

			var reactionText = drawReactionText();

			/// Main entry point for javascript
			function start() {
				// Assign values to variables
				loops = 0;
				playedBefore = false;
				beginPlaying = false;
				doesCircleExist = false;
				playerLost = false;
				secondsBeforeClicked = 0;
				reactionAverage = [];

				beginGame();
			}

			/// Main function to get time
			function setTime() {
				var date = new Date();
				return date.getTime() / 1000; // Get seconds since Epoch (1/1/1970)
			}

			/// Main function to control game, treat as the true start function
			function beginGame() {

				mouseClickMethod(assignPoints);
				setTimer(step, Randomizer.nextInt(5000, 12000)); // Why doesn't it continously randomize?
			}

			function assignPoints(e) {
				var element = getElementAt(e.getX(), e.getY());
				if (element != null && element.color == Color.green && element.type == "Circle") {
					setReaction(e);
				}
			}

			function step() {
				if (loops == 5) {
					endGame();
				}
				else {
					beginDrawingCircles();
				}
			}

			// Main function to control circle generation
			function beginDrawingCircles() {
				var circle = drawCircle();
				if (doesCircleExist == false) {
					add(circle);
					secondsBeforeClicked = setTime();
					doesCircleExist = true;
				}
			}

			function setReaction(e) {
				remove(getElementAt(e.getX(), e.getY()));
				var reactionTime = setTime() - secondsBeforeClicked;
				reactionAverage.push(reactionTime * 1000);
				loops++;
				doesCircleExist = false;
			}

			/// Helper Functions, mostly reusable/modular
			function drawReactionText() {
				var s = new Text("Reaction Time: ", "30pt Calibri");
				s.setPosition(screen[2] - s.getWidth() / 2, screen[3]);
				s.setColor(Color.black);
				return s;
			}

			function drawCircle() {
				var c = new Circle(100);
				c.setPosition(screen[2], screen[3]);
				/* Set color, from the colors defined in the color array,
				* and get a randomized value, to pull a random color from said array
				*/
				c.setColor(Color.green);
				return c;
			}

			/// Main function to end game
			function endGame() {
				stopTimer(step);
				var reactionText = drawReactionText();
				var reactionTime = calculateAverage();
				reactionText.setText("Reaction Time: " + reactionTime + "ms");
				reactionText.setPosition(screen[2] - reactionText.getWidth() / 2, screen[3]);
				add(reactionText);
			}

			function calculateAverage() {
				var arrAverage = 0;
				var arrLength = reactionAverage.length;
				for (var i = 0; i < arrLength; i++) {
					arrAverage += reactionAverage[i];
				}
				return Math.round(arrAverage / arrLength);
			}


			if (typeof start === 'function') {
				start();
			}
		};

		// Messy script
		var b = document.getElementById("button"), t = document.getElementById("text"), i = document.getElementById("icon");
		b.addEventListener("mouseover", function () {
			b.style.boxShadow = "0 0 100px 0 rgba(255, 255, 255, 0.4)";
			b.style.backgroundColor = "#303030";
			t.style.color = "white";
			i.style.color = "white";
		});

		b.addEventListener("mouseout", function () {
			b.style.boxShadow = "0 0 10px 0 rgba(0, 0, 0, 0.4)";
			b.style.backgroundColor = "#D3D3D3";
			t.style.color = "black";
			i.style.color = "black";
		});

	</script>
</body>
</html>