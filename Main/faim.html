<!DOCTYPE html>
<html>
<head>
	<!-- Import StyleSheet, Icon, and FontAwesome -->
	<link rel="icon" href="https://puu.sh/yF7r5/6b4c2965e9.png">
	<link href="style.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- Import CodeHS dependancies-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="https://static.codehs.com/gulp/9fad0d591712b48ff1a19f4027446782eed9c0c4/chs-js-lib/chs.js"></script>

	<!-- Import JavaScripts -->
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript" src="time.js"></script>
	<title>Fast Aim</title>
</head>
<body class="bg-gradient fg-white center-text">
	<div id="mySidenav" class="sidenavBar"></div>
	<div class="fade-in">
		<div id="header"></div>
		<h1>Fast Aim</h1>
		<canvas width="600" height="600" class="codehs-editor-canvas"></canvas>
		<p>Welcome to Fast Aim. You will attempt click circles as they appear on the screen. The game will get progressively faster as you keep playing. Good luck and have fun!</p>
	</div>
</body>
</html>
<script>
	window.addEventListener("load", function () {
		// Global Variables
		var theTarget, difficulty, title, score, lives;
		var clickedCircle, circleNumber, targetText;
		var isPaused, pauseText;
		var initialRun;

		// Text Variables
		var scoreText;
		var livesText;
		var pauseText;

		// Time Variables
		var gameTime;

		// Color Variables
		var shiftedGray = new Color(205, 205, 205);
		var shiftedBlack = new Color(1, 1, 1);

		// Gets the width and height of canvas, then find the center.
		var screenTypes = [getWidth(), getHeight(), getWidth() / 2, getHeight() / 2];

		function start() {
			difficulty = 1000;
			score = 0;
			lives = 3;
			isPaused = false;
			circleNumber = 0;
			initialRun = true; // The initial loop in timers, must be disabled permanently after first loop.
			scoreText = [];
			livesText = [];

			drawMenu();
		}

		function startGame() {
			removeAll();
			setTimer(step, 33);
			renderFirstElements();
			Randomize();
		}

		function pauseGame() {
			stopTimer(drawRandomCircles);
			createText("Game Paused", "24pt sans-serif", screenTypes[2], 24, false, pauseText);
		}

		function unpauseGame() {
			remove(pauseText[0].t);
			Randomize();
		}

		function endGame() {
			stopTimer(step);
			stopTimer(drawRandomCircles);
			removeAll();
		}

		function step() {
			if (lives == 0) {
				endGame();
			}
			updateElementText(livesText[0].t, "Lives: " + lives);
			updateElementText(scoreText[0].t, "Score: " + score);
		}

		function renderFirstElements() {
			createText("Score: " + score, "16pt sans-serif", 0 + 48, -16, false, scoreText);
			createText("Lives: " + lives, "16pt sans-serif", screenTypes[0] - 48, -16, false, livesText);
		}

		function Randomize() {
			stopTimer(drawRandomCircles);
			setTimer(drawRandomCircles, difficulty);
		}

		function drawRandomCircles() {
			if (!clickedCircle && !initialRun) {
				penalizeThePlayer();
			}
			if (initialRun == true) { initialRun = false; }
			theTarget = new Circle(32);
			theTarget.setPosition(Randomizer.nextInt(0 + theTarget.getWidth(), getWidth() - theTarget.getRadius()), Randomizer.nextInt(0 + theTarget.getRadius(), getHeight() - theTarget.getRadius()));
			theTarget.setColor(Randomizer.nextColor());

			targetText = new Text(circleNumber, "24pt sans-serif");
			targetText.setPosition(theTarget.getX() - (targetText.getWidth() / 2), theTarget.getY() + (targetText.getHeight() / 3));
			targetText.setColor(Color.black);

			add(theTarget);
			add(targetText);

			circleNumber++;
			clickedCircle = false;
		}

		function penalizeThePlayer() {
			remove(theTarget); // Remove the circle he couldn't click
			remove(targetText); // Remove the text which is binded to the player
			if (lives >= 1) {
				lives--;
			}
		}

		function drawMenu() {
			createText("FastAim!", "30pt sans-serif", screenTypes[2], 0, false, null);
			createButton("Start", "24pt sans-serif", 100, 50, screenTypes[2], screenTypes[3] + getHeight() / 4, null);

			mouseClickMethod(performAction_Click);
		}

		function points() {
			remove(theTarget);
			remove(targetText);
			difficulty -= 10; // Make the game slightly more difficult, you should only be able to click 100 circles, since it gets crazy fast any further.
			clickedCircle = true;
			score++;
			Randomize(); // Restart drawCircle with new Time. Circles get drawn only after user can actually click one.
		}

		/// Helper Functions

		// Creates a graphic text string
		function createText(text, font, cX, cY, messageBox, array) {
			var pText = {
				t: new Text(text, font),
				c: new Rectangle(getWidth(), new Text(text, font).getHeight() + 50), // I dont like this method, but I could not get 'this' property to work.
			};

			pText.t.setPosition(cX - pText.t.getWidth() / 2, cY + pText.c.getHeight() / 2 + (pText.t.getHeight() / 3));
			pText.t.setColor(shiftedBlack);

			pText.c.setPosition(cX - pText.c.getWidth() / 2, cY);
			pText.c.setColor(shiftedGray);

			if (array !== null) {
				array.push(pText);
			}

			if (messageBox) {
				add(pText.c);
			}
			add(pText.t);
		}

		// Creates a smooth button, with text inside it, where c = container, and t = text
		function createButton(text, font, cWidth, cHeight, cX, cY, array) {
			var pButton = {
				t: new Text(text, font),
				c: new Rectangle(cWidth, cHeight),
				c1: new Circle(cHeight / 2),
				c2: new Circle(cHeight / 2),
			};

			pButton.t.setPosition(cX - pButton.t.getWidth() / 2, cY + pButton.c.getHeight() / 2 + (pButton.t.getHeight() / 3));
			pButton.t.setColor(Color.black);

			pButton.c1.setPosition(cX - pButton.c.getWidth() / 2, cY + pButton.c.getHeight() / 2);
			pButton.c2.setPosition(cX + pButton.c.getWidth() / 2, cY + pButton.c.getHeight() / 2);

			pButton.c1.setColor(Color.gray);
			pButton.c2.setColor(Color.gray);

			pButton.c.setPosition(cX - pButton.c.getWidth() / 2, cY);
			pButton.c.setColor(Color.gray);

			if (array !== null) {
				array.push(pButton);
			}

			add(pButton.c1);
			add(pButton.c2);
			add(pButton.c);
			add(pButton.t);
		}

		function updateElementText(textElem, stringText) {
			textElem.setText(stringText);
		}

		function performAction_Click(e) {
			var element = getElementAt(e.getX(), e.getY());
			// Long and ugly condition
			if (element != null && (element.type == "Rectangle" || element.type == "Circle" || element.type == "Text") && (element.color == Color.gray || element.color == Color.black)) {
				startGame();
			}
			if (element == theTarget || element == targetText) {
				points();
			}
		}

		function performAction_keyDown(e) {
			if (e.keyCode == 27) { // ESCAPE key is being pressed
				if (isPaused == true) {
					unpauseGame();
					isPaused = false;
				}
				else {
					pauseGame();
					isPaused = true;
				}
			}
		}

		if (typeof start === 'function') {
			start();
		}
	});
</script>