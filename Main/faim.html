<!DOCTYPE html>
<html>
<head>
	<!-- Import StyleSheet, Icon, and FontAwesome -->
	<link rel="icon" href="https://puu.sh/yF7r5/6b4c2965e9.png">
	<link href="style.css" rel="stylesheet" type="text/css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

	<!-- Import CodeHS dependancies-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<script type="text/javascript" src="https://static.codehs.com/gulp/9fad0d591712b48ff1a19f4027446782eed9c0c4/chs-js-lib/chs.js"></script>

	<!-- Import JavaScripts -->
	<script type="text/javascript" src="main.js"></script>
	<script type="text/javascript" src="time.js"></script>
	<title>Fast Aim</title>
</head>
<body class="bg-gradient fg-white center-text">
	<div id="mySidenav" class="sidenavBar"></div>
	<div class="fade-in">
		<div id="header"></div>
		<h1>Fast Aim</h1>
		<canvas width="600" height="600" class="codehs-editor-canvas"></canvas>
		<p>Welcome to Fast Aim. You will attempt click circles as they appear on the screen. The game will get progressively faster as you keep playing. Good luck and have fun!</p>
	</div>
</body>
</html>
<script>
	window.addEventListener("load", function () {
		// Global Variables
		var theTarget, difficulty, title, score, lives;
		var clickedCircle, circleNumber, targetText;
		var isPaused, pauseText;
		var initialRun;

		// Text Variables
		var timeText;
		var scoreText;
		var livesText;

		// Time Variables
		var gameTime;

		// Color Variables
		var shiftedGray = new Color(205, 205, 205);
		var shiftedBlack = new Color(1, 1, 1);

		// Gets the width and height of canvas, then find the center.
		var screenTypes = [getWidth(), getHeight(), getWidth() / 2, getHeight() / 2];

		function start() {
			difficulty = 1000;
			score = 0;
			lives = 3;
			isPaused = false;
			circleNumber = 0;
			initialRun = true; // The initial loop in timers, must be disabled permanently after first loop.

			drawMenu();
		}

		function startGame() {
			removeAll();
			setTimer(step, 33);
			renderFirstElements();
			Randomize();
		}

		function pauseGame() {
			// Since pauseText is handled differently from the normal createText functions, it is redefined here
			stopTimer(drawRandomCircles);
			pauseText = new Text("Game Paused", "24pt sans-serif");
			pauseText.setPosition(screenTypes[2] - (pauseText.getWidth() / 2), screenTypes[3]);
			pauseText.setColor(shiftedBlack);
			add(pauseText);
		}

		function unpauseGame() {
			remove(pauseText);
			Randomize();
		}

		function endGame() {
			stopTimer(step);
			stopTimer(drawRandomCircles);
			removeAll();
		}

		function step() {
			if (lives == 0) {
				endGame();
			}
		}

		function renderFirstElements() {
			scoreText = createText("Score: " + score, "16pt sans-serif", 0 + 48, -16, false);
			add(scoreText);

			livesText = createText("Lives: " + lives, "16pt sans-serif", screenTypes[0] - 48, -16, false);
			add(livesText);
		}

		function Randomize() {
			stopTimer(drawRandomCircles);
			setTimer(drawRandomCircles, difficulty);
		}

		function drawRandomCircles() {
			if (!clickedCircle && !initialRun) {
				penalizeThePlayer();
			}
			if (initialRun == true) { initialRun = false; }
			theTarget = new Circle(32);
			theTarget.setPosition(Randomizer.nextInt(0 + theTarget.getWidth(), getWidth() - theTarget.getRadius()), Randomizer.nextInt(0 + theTarget.getRadius(), getHeight() - theTarget.getRadius()));
			theTarget.setColor(Randomizer.nextColor());

			targetText = new Text(circleNumber, "24pt sans-serif");
			targetText.setPosition(theTarget.getX() - (targetText.getWidth() / 2), theTarget.getY() + (targetText.getHeight() / 3));
			targetText.setColor(Color.black);

			add(theTarget);
			add(targetText);

			circleNumber++;
			clickedCircle = false;
		}

		function penalizeThePlayer() {
			remove(theTarget); // Remove the circle he couldn't click
			remove(targetText); // Remove the text which is binded to the player
			if (lives >= 1) {
				lives--;
				updateElementText(livesText, "Lives: " + lives);
			}
		}

		function drawMenu() {
			add(createText("FastAim!", "30pt sans-serif", screenTypes[2], 0, false));
			createButton("Start", "24pt sans-serif", 100, 50, screenTypes[2], screenTypes[3] + getHeight() / 4);

			mouseClickMethod(performAction_Click);
		}

		function points() {
			remove(theTarget);
			remove(targetText);
			difficulty -= 10; // Make the game slightly more difficult, you should only be able to click 100 circles, since it gets crazy fast any further.
			clickedCircle = true;
			score++;
			updateElementText(scoreText, "Score: " + score);
			Randomize(); // Restart drawCircle with new Time. Circles get drawn only after user can actually click one.
		}

		/// Helper Functions

		function updateElementText(textElem, stringText) {
			textElem.setText(stringText);
		}

		// Creates a graphic text string
		function createText(text, font, cX, cY, messageBox = true) {
			var textVar = new Text(text, font);
			var c = new Rectangle(getWidth(), textVar.getHeight() + 50);

			textVar.setPosition(cX - textVar.getWidth() / 2, cY + c.getHeight() / 2 + (textVar.getHeight() / 3));
			textVar.setColor(shiftedBlack);

			c.setPosition(cX - c.getWidth() / 2, cY);
			c.setColor(shiftedGray);

			if (messageBox) {
				add(c);
			}
			return textVar;
		}

		// Creates a smooth button, with text inside it, where c = container, and t = text
		function createButton(text, font, cWidth, cHeight, cX, cY) {
			var t = new Text(text, font);
			var c = new Rectangle(cWidth, cHeight);
			var c1 = new Circle(cHeight / 2);
			var c2 = new Circle(cHeight / 2);

			t.setPosition(cX - t.getWidth() / 2, cY + c.getHeight() / 2 + (t.getHeight() / 3));
			t.setColor(Color.black);

			c1.setPosition(cX - c.getWidth() / 2, cY + c.getHeight() / 2);
			c2.setPosition(cX + c.getWidth() / 2, cY + c.getHeight() / 2);

			c1.setColor(Color.gray);
			c2.setColor(Color.gray);

			c.setPosition(cX - c.getWidth() / 2, cY);
			c.setColor(Color.gray);

			add(c1);
			add(c2);
			add(c);
			add(t);
		}

		function performAction_Click(e) {
			var element = getElementAt(e.getX(), e.getY());
			// Long and ugly condition
			if (element != null && (element.type == "Rectangle" || element.type == "Circle" || element.type == "Text") && (element.color == Color.gray || element.color == Color.black)) {
				startGame();
			}
			if (element == theTarget || element == targetText) {
				points();
			}
		}

		function performAction_keyDown(e) {
			if (e.keyCode == 27) { // ESCAPE key is being pressed
				if (isPaused == true) {
					unpauseGame();
					isPaused = false;
				}
				else {
					pauseGame();
					isPaused = true;
				}
			}
		}

		if (typeof start === 'function') {
			start();
		}
	});
</script>